<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mass Intention Tracking System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .controls-section {
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #ddd;
        }
        
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
        }
        
        .control-group label {
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }
        
        .control-group select,
        .control-group input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            margin: 5px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .stats-bar {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
            padding: 20px;
            background: #f8f9fa;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            min-width: 150px;
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #4facfe;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9em;
        }
        
        .data-section {
            padding: 30px;
        }
        
        .month-header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            text-align: center;
            font-size: 1.5em;
            font-weight: 600;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .editable {
            background: #fff;
            border: 1px solid #ddd;
            padding: 8px;
            border-radius: 3px;
            width: 100%;
        }
        
        .editable:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 5px rgba(79, 172, 254, 0.3);
        }
        
        .special-day {
            background: #fff3cd !important;
            color: #856404;
        }
        
        .personal-intention {
            background: #d1ecf1 !important;
            color: #0c5460;
        }
        
        .deceased-mass {
            background: #f8d7da !important;
            color: #721c24;
        }
        
        .add-entry-form {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: black;
        }
        
        .export-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .controls-grid {
                grid-template-columns: 1fr;
            }
            .stats-bar {
                flex-direction: column;
            }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Mass Intention Tracking System</h1>
            <p>MSFS - Missionaries of St. Francis de Sales</p>
        </div>
        
        <!-- Controls Section -->
        <div class="controls-section">
            <div class="controls-grid">
                <div class="control-group">
                    <label for="yearSelect">Select Year:</label>
                    <select id="yearSelect" onchange="updateDisplay()">
                        <option value="2023">2023</option>
                        <option value="2024" selected>2024</option>
                        <option value="2025">2025</option>
                        <option value="2026">2026</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="monthSelect">Select Month:</label>
                    <select id="monthSelect" onchange="updateDisplay()">
                        <option value="all">All Months</option>
                        <option value="1">January</option>
                        <option value="2">February</option>
                        <option value="3">March</option>
                        <option value="4">April</option>
                        <option value="5">May</option>
                        <option value="6">June</option>
                        <option value="7">July</option>
                        <option value="8">August</option>
                        <option value="9">September</option>
                        <option value="10">October</option>
                        <option value="11">November</option>
                        <option value="12">December</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="viewType">View Type:</label>
                    <select id="viewType" onchange="updateDisplay()">
                        <option value="daily">Daily Masses</option>
                        <option value="deceased">Deceased Confreres</option>
                        <option value="personal">Personal Intentions</option>
                        <option value="summary">Summary Report</option>
                    </select>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 15px;">
                <button class="btn btn-primary" onclick="addNewEntry()">Add New Entry</button>
                <button class="btn btn-success" onclick="uploadDatabase()">Upload Database</button>
                <button class="btn btn-warning" onclick="showExportOptions()">Export Data</button>
                <input type="file" id="fileInput" accept=".xlsx,.xls" style="display: none;" onchange="handleFileUpload(event)">
            </div>
        </div>
        
        <!-- Statistics Bar -->
        <div class="stats-bar">
            <div class="stat-card">
                <div class="stat-number" id="totalMasses">0</div>
                <div class="stat-label">Total Masses</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="celebratedMasses">0</div>
                <div class="stat-label">Celebrated</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="missedMasses">0</div>
                <div class="stat-label">Missed</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="personalMasses">0</div>
                <div class="stat-label">Personal Intentions</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="deceasedMasses">0</div>
                <div class="stat-label">Deceased Confreres</div>
            </div>
        </div>
        
        <!-- Data Display Section -->
        <div class="data-section">
            <div id="dataDisplay"></div>
        </div>
    </div>
    
    <!-- Add Entry Modal -->
    <div id="addEntryModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addEntryModal')">&times;</span>
            <h2>Add New Mass Entry</h2>
            <div class="form-grid">
                <div class="control-group">
                    <label for="entryDate">Date (MM/DD/YYYY):</label>
                    <input type="date" id="entryDate" class="editable">
                </div>
                <div class="control-group">
                    <label for="entrySerial">Serial No:</label>
                    <input type="number" id="entrySerial" class="editable">
                </div>
                <div class="control-group">
                    <label for="entryReceiptDate">Date of Receipt:</label>
                    <input type="date" id="entryReceiptDate" class="editable">
                </div>
                <div class="control-group">
                    <label for="entryFrom">From Whom:</label>
                    <input type="text" id="entryFrom" class="editable" placeholder="Provincial Superior">
                </div>
                <div class="control-group">
                    <label for="entryIntention">Intentions:</label>
                    <input type="text" id="entryIntention" class="editable" placeholder="General Intention">
                </div>
                <div class="control-group">
                    <label for="entryRemarks">Remarks:</label>
                    <input type="text" id="entryRemarks" class="editable">
                </div>
                <div class="control-group">
                    <label for="entryType">Mass Type:</label>
                    <select id="entryType" class="editable">
                        <option value="daily">Daily Mass</option>
                        <option value="personal">Personal Intention</option>
                        <option value="deceased">Deceased Confrere</option>
                        <option value="special">Special Occasion</option>
                    </select>
                </div>
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-primary" onclick="saveEntry()">Save Entry</button>
                <button class="btn" onclick="closeModal('addEntryModal')">Cancel</button>
            </div>
        </div>
    </div>
    
    <!-- Export Options Modal -->
    <div id="exportModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('exportModal')">&times;</span>
            <h2>Export Options</h2>
            
            <div class="export-options">
                <div class="control-group">
                    <label for="exportYear">Year:</label>
                    <select id="exportYear">
                        <option value="all">All Years</option>
                        <option value="2023">2023</option>
                        <option value="2024">2024</option>
                        <option value="2025">2025</option>
                        <option value="2026">2026</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="exportMonth">Month:</label>
                    <select id="exportMonth">
                        <option value="all">All Months</option>
                        <option value="1">January</option>
                        <option value="2">February</option>
                        <option value="3">March</option>
                        <option value="4">April</option>
                        <option value="5">May</option>
                        <option value="6">June</option>
                        <option value="7">July</option>
                        <option value="8">August</option>
                        <option value="9">September</option>
                        <option value="10">October</option>
                        <option value="11">November</option>
                        <option value="12">December</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="exportFormat">Format:</label>
                    <select id="exportFormat">
                        <option value="xlsx">Excel (.xlsx)</option>
                        <option value="csv">CSV (.csv)</option>
                        <option value="json">JSON (.json)</option>
                    </select>
                </div>
            </div>
            
            <div style="margin-top: 20px;">
                <h3>Select Columns to Export:</h3>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 10px;">
                    <label><input type="checkbox" id="col_date" checked> Date</label>
                    <label><input type="checkbox" id="col_serial" checked> Serial No</label>
                    <label><input type="checkbox" id="col_receipt" checked> Date of Receipt</label>
                    <label><input type="checkbox" id="col_from" checked> From Whom</label>
                    <label><input type="checkbox" id="col_intention" checked> Intentions</label>
                    <label><input type="checkbox" id="col_remarks" checked> Remarks</label>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-success" onclick="exportData()">Export</button>
                <button class="btn" onclick="closeModal('exportModal')">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // Global data storage
        let massDatabase = {
            daily: [],
            deceased: [],
            personal: []
        };
        
        // Month names
        const monthNames = [
            'January', 'February', 'March', 'April', 'May', 'June',
            'July', 'August', 'September', 'October', 'November', 'December'
        ];
        
        // Initialize the application
        function init() {
            loadSampleData();
            updateDisplay();
            updateStats();
        }
        
        // Load sample data
        function loadSampleData() {
            // Sample daily masses
            massDatabase.daily = [
                {
                    date: '01/01/2024',
                    serial: 300,
                    receiptDate: '08/23/2023',
                    from: 'Provincial Superior',
                    intention: 'General Intention',
                    remarks: '',
                    type: 'daily'
                },
                {
                    date: '01/24/2024',
                    serial: 277,
                    receiptDate: '08/23/2023',
                    from: 'Provincial Superior',
                    intention: 'General Intention',
                    remarks: 'SFS Feast Day Mass Celebrated',
                    type: 'special'
                }
            ];
            
            // Sample deceased confreres
            massDatabase.deceased = [
                {
                    date: '01/13/2024',
                    receiptDate: '01/12/2024',
                    deathDate: '01/12/2024',
                    name: 'Fr. Mariadas Sesetti',
                    celebrated: '01/13/2024',
                    province: 'Vizag Province'
                },
                {
                    date: '02/15/2024',
                    receiptDate: '02/14/2024',
                    deathDate: '02/14/2024',
                    name: 'Fr. Joseph Charles Pednekar',
                    celebrated: '02/15/2024',
                    province: 'Goa Province'
                }
            ];
            
            // Sample personal intentions
            massDatabase.personal = [
                {
                    date: '01/18/2024',
                    month: 'January',
                    massNumber: 1,
                    intention: "Gladwin's Birthday Mass",
                    type: 'personal'
                },
                {
                    date: '02/16/2024',
                    month: 'February',
                    massNumber: 1,
                    intention: "Dominic's Birthday Mass",
                    type: 'personal'
                }
            ];
        }
        
        // Update display based on selected filters
        function updateDisplay() {
            const year = document.getElementById('yearSelect').value;
            const month = document.getElementById('monthSelect').value;
            const viewType = document.getElementById('viewType').value;
            
            const displayDiv = document.getElementById('dataDisplay');
            
            switch(viewType) {
                case 'daily':
                    displayDailyMasses(year, month);
                    break;
                case 'deceased':
                    displayDeceasedMasses(year, month);
                    break;
                case 'personal':
                    displayPersonalMasses(year, month);
                    break;
                case 'summary':
                    displaySummary(year, month);
                    break;
            }
            
            updateStats();
        }
        
        // Display daily masses
        function displayDailyMasses(year, month) {
            const displayDiv = document.getElementById('dataDisplay');
            let html = '';
            
            if (month === 'all') {
                for (let m = 1; m <= 12; m++) {
                    html += generateMonthTable(year, m);
                }
            } else {
                html = generateMonthTable(year, parseInt(month));
            }
            
            displayDiv.innerHTML = html;
        }
        
        // Generate month table
        function generateMonthTable(year, monthNum) {
            const monthName = monthNames[monthNum - 1];
            const daysInMonth = new Date(year, monthNum, 0).getDate();
            
            let html = `
                <div class="month-header">${monthName.toUpperCase()} (${year})</div>
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Serial No.</th>
                            <th>Date of Receipt</th>
                            <th>From Whom</th>
                            <th>Intentions</th>
                            <th>Remarks</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${String(monthNum).padStart(2, '0')}/${String(day).padStart(2, '0')}/${year}`;
                const dayStr = `${day}/${year}`;
                const existingEntry = massDatabase.daily.find(entry => entry.date === dateStr);
                
                const serial = existingEntry ? existingEntry.serial : '';
                const receiptDate = existingEntry ? formatDateForDisplay(existingEntry.receiptDate) : '';
                const from = existingEntry ? existingEntry.from : '';
                const intention = existingEntry ? existingEntry.intention : '';
                const remarks = existingEntry ? existingEntry.remarks : '';
                
                html += `
                    <tr>
                        <td>${dayStr}</td>
                        <td class="editable-cell" data-field="serial" data-date="${dateStr}">${serial}</td>
                        <td class="editable-cell" data-field="receiptDate" data-date="${dateStr}">${receiptDate}</td>
                        <td class="editable-cell" data-field="from" data-date="${dateStr}">${from}</td>
                        <td class="editable-cell" data-field="intention" data-date="${dateStr}">${intention}</td>
                        <td class="editable-cell" data-field="remarks" data-date="${dateStr}">${remarks}</td>
                        <td>
                            <button class="btn btn-primary" style="padding: 5px 10px; font-size: 0.8em;" onclick="editEntry('${dateStr}')">Edit</button>
                            <button class="btn btn-warning" style="padding: 5px 10px; font-size: 0.8em;" onclick="deleteEntry('${dateStr}')">Delete</button>
                        </td>
                    </tr>
                `;
            }
            
            html += `
                    </tbody>
                </table>
            `;
            
            return html;
        }
        
        // Display deceased masses
        function displayDeceasedMasses(year, month) {
            const displayDiv = document.getElementById('dataDisplay');
            
            let filteredData = massDatabase.deceased;
            if (year !== 'all') {
                filteredData = filteredData.filter(entry => entry.date.includes(year));
            }
            if (month !== 'all') {
                const monthStr = String(month).padStart(2, '0');
                filteredData = filteredData.filter(entry => entry.date.startsWith(monthStr));
            }
            
            let html = `
                <div class="month-header">Masses for Deceased Confreres (${year})</div>
                <p><em>As per MSFS Constitution 118 and General Directory No. 98</em></p>
                <table>
                    <thead>
                        <tr>
                            <th>Date of Receipt</th>
                            <th>Date of Death</th>
                            <th>Name of Deceased</th>
                            <th>When Celebrated</th>
                            <th>Province</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            filteredData.forEach(entry => {
                html += `
                    <tr>
                        <td>${formatDateForDisplay(entry.receiptDate)}</td>
                        <td>${formatDateForDisplay(entry.deathDate)}</td>
                        <td>${entry.name}</td>
                        <td>${formatDateForDisplay(entry.celebrated)}</td>
                        <td>${entry.province || ''}</td>
                        <td>
                            <button class="btn btn-primary" style="padding: 5px 10px; font-size: 0.8em;" onclick="editDeceasedEntry('${entry.date}')">Edit</button>
                            <button class="btn btn-warning" style="padding: 5px 10px; font-size: 0.8em;" onclick="deleteDeceasedEntry('${entry.date}')">Delete</button>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                    </tbody>
                </table>
            `;
            
            displayDiv.innerHTML = html;
        }
        
        // Display personal masses
        function displayPersonalMasses(year, month) {
            const displayDiv = document.getElementById('dataDisplay');
            
            let filteredData = massDatabase.personal;
            if (year !== 'all') {
                filteredData = filteredData.filter(entry => entry.date.includes(year));
            }
            
            let html = `
                <div class="month-header">Personal Intention Masses (${year})</div>
                <p><em>Three personal intentions per month as per regulations</em></p>
                <table>
                    <thead>
                        <tr>
                            <th>Month</th>
                            <th>Date</th>
                            <th>Mass Number</th>
                            <th>Intention</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            filteredData.forEach(entry => {
                html += `
                    <tr>
                        <td>${entry.month}</td>
                        <td>${formatDateForDisplay(entry.date)}</td>
                        <td>${entry.massNumber}</td>
                        <td>${entry.intention}</td>
                        <td>
                            <button class="btn btn-primary" style="padding: 5px 10px; font-size: 0.8em;" onclick="editPersonalEntry('${entry.date}')">Edit</button>
                            <button class="btn btn-warning" style="padding: 5px 10px; font-size: 0.8em;" onclick="deletePersonalEntry('${entry.date}')">Delete</button>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                    </tbody>
                </table>
            `;
            
            displayDiv.innerHTML = html;
        }
        
        // Display summary
        function displaySummary(year, month) {
            const displayDiv = document.getElementById('dataDisplay');
            
            const stats = calculateStats(year, month);
            
            let html = `
                <div class="month-header">Summary Report (${year})</div>
                <div class="summary-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
                    <div class="summary-card" style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                        <h3 style="color: #4facfe; margin-top: 0;">Mass Statistics</h3>
                        <p><strong>Total Daily Masses:</strong> ${stats.totalDaily}</p>
                        <p><strong>Personal Intention Masses:</strong> ${stats.totalPersonal}</p>
                        <p><strong>Deceased Confreres Masses:</strong> ${stats.totalDeceased}</p>
                        <p><strong>Total Masses Celebrated:</strong> ${stats.totalAll}</p>
                    </div>
                    
                    <div class="summary-card" style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                        <h3 style="color: #4facfe; margin-top: 0;">Monthly Breakdown</h3>
                        <p><strong>Average per Month:</strong> ${(stats.totalAll / 12).toFixed(1)}</p>
                        <p><strong>Most Active Month:</strong> ${stats.mostActiveMonth}</p>
                        <p><strong>Special Occasions:</strong> ${stats.specialOccasions}</p>
                    </div>
                </div>
            `;
            
            displayDiv.innerHTML = html;
        }
        
        // Calculate statistics
        function calculateStats(year, month) {
            let dailyCount = massDatabase.daily.length;
            let personalCount = massDatabase.personal.length;
            let deceasedCount = massDatabase.deceased.length;
            
            if (year !== 'all') {
                dailyCount = massDatabase.daily.filter(entry => entry.date.includes(year)).length;
                personalCount = massDatabase.personal.filter(entry => entry.date.includes(year)).length;
                deceasedCount = massDatabase.deceased.filter(entry => entry.date.includes(year)).length;
            }
            
            return {
                totalDaily: dailyCount,
                totalPersonal: personalCount,
                totalDeceased: deceasedCount,
                totalAll: dailyCount + personalCount + deceasedCount,
                mostActiveMonth: 'January', // This would be calculated from actual data
